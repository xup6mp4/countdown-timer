<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover, user-scalable=no">
<title>倒數計時器 ⏳（閃爍＋音效＋上移0.5cm）</title>
<meta name="theme-color" content="#0f172a">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="倒數計時器">
<link rel="manifest" href="manifest.webmanifest">
<link rel="icon" type="image/png" sizes="192x192" href="icons/icon-192.png">
<link rel="icon" type="image/png" sizes="512x512" href="icons/icon-512.png">
<link rel="apple-touch-icon" sizes="180x180" href="icons/icon-180.png">
<style>
:root {--bg:#0f172a;--text:#e5e7eb;--accent:#22c55e;--warning:#f59e0b;--muted:#94a3b8;}
body{
margin:0;
font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Noto Sans,Helvetica Neue,Arial;
background:radial-gradient(1200px 1200px at 80% -20%,#1f2937 0,var(--bg) 50%);
color:var(--text);
display:flex;justify-content:center;align-items:flex-start;
padding:calc(env(safe-area-inset-top)+0.5cm+16px) calc(env(safe-area-inset-right)+16px) calc(env(safe-area-inset-bottom)+16px) calc(env(safe-area-inset-left)+16px);
min-height:100dvh;overflow-x:hidden;}
.card{width:min(700px,100vw);background:rgba(255,255,255,0.05);border-radius:20px;padding:24px 20px;transform:scale(0.9);transform-origin:center top;}
.display{font-size:clamp(96px,14vw,144px);padding:calc(80px - 0.25cm) 0;border-radius:24px;border:2px solid rgba(255,255,255,.2);background:rgba(255,255,255,.04);text-align:center;margin:10px 0;}
.display small{font-size:.33em;color:var(--muted);}
button{border:none;border-radius:12px;padding:10px 16px;margin:5px;cursor:pointer;}
.primary{background:var(--accent);color:#041e0e;font-weight:700;}
.warn{background:var(--warning);color:#2e1b00;font-weight:900;font-size:48px;width:100%;}
#flash{position:fixed;inset:0;background:#fff;opacity:0;pointer-events:none;z-index:9999;}
.flash #flash{animation:flashBlink 1s ease-in-out 3;}
@keyframes flashBlink{0%,100%{opacity:0;}50%{opacity:.9;}}
</style>
</head>
<body>
<div id="flash"></div>
<main class="card">
<h1>倒數計時器</h1>
<div id="screen" class="display">00:00<small>.0</small></div>
<div>
<label>分鐘<input id="min" type="number" min="0" value="5"></label>
<label>秒數<input id="sec" type="number" min="0" max="59" value="0"></label>
<label>加時(秒)<input id="inc" type="number" min="1" value="60"></label>
</div>
<div>
<button id="startPause" class="primary">開始</button>
<button id="reset">重設</button>
<button id="quick1m">+1 分鐘</button>
<button id="quick30s">+30 秒</button>
</div>
<button id="add" class="warn">+ 加時</button>
</main>
<script>
let running=false,remainingMs=0,targetTs=0,raf=null,timer=null;
const scr=document.getElementById('screen'),msSmall=scr.querySelector('small');
function fmt(ms){ms=Math.max(0,Math.floor(ms));const s=Math.floor(ms/1000),m=Math.floor(s/60);return{m,s:s%60,ds:Math.floor((ms%1000)/100)};}
function render(ms){const{m,s,ds}=fmt(ms);scr.innerHTML=`${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}<small>.${ds}</small>`;}
function read(){return((+min.value||0)*60+(+sec.value||0))*1000;}
function start(){if(running)return;if(remainingMs<=0)remainingMs=read();if(!remainingMs)return;running=true;targetTs=performance.now()+remainingMs;startPause.textContent='暫停';tick();loop();}
function pause(){running=false;remainingMs=Math.max(0,targetTs-performance.now());startPause.textContent='開始';cancel();}
function reset(){running=false;remainingMs=read();render(remainingMs);startPause.textContent='開始';cancel();}
function add(s){if(!s)return;if(!running){remainingMs+=(s*1000);render(remainingMs);}else targetTs+=s*1000;}
function tick(){if(timer)clearTimeout(timer);const t=()=>{const l=Math.max(0,targetTs-performance.now());render(l);if(l<=0){finish();return;}timer=setTimeout(t,100);};t();}
function loop(){const f=()=>{if(!running)return;const l=Math.max(0,targetTs-performance.now());if(l<=0){finish();return;}raf=requestAnimationFrame(f);};raf=requestAnimationFrame(f);}
function cancel(){if(raf)cancelAnimationFrame(raf);if(timer)clearTimeout(timer);}
function flash(){document.body.classList.add('flash');setTimeout(()=>document.body.classList.remove('flash'),3000);}
function finish(){running=false;startPause.textContent='開始';render(0);flash();cancel();}
startPause.onclick=()=>running?pause():start();
reset.onclick=reset;
add.onclick=()=>add(+inc.value);
quick1m.onclick=()=>add(60);
quick30s.onclick=()=>add(30);
render(read());
</script>
</body>
</html>