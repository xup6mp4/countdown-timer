<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover, user-scalable=no" />
  <title>倒數計時器 ⏳（震動版）</title>

  <meta name="theme-color" content="#0f172a" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="倒數計時器" />
  <link rel="manifest" href="manifest.webmanifest?v=8" />
  <link rel="icon" type="image/png" sizes="192x192" href="icons/icon-192.png?v=3" />
  <link rel="icon" type="image/png" sizes="512x512" href="icons/icon-512.png?v=3" />
  <link rel="apple-touch-icon" sizes="180x180" href="icons/icon-180.png?v=3" />

  <style>
    :root {
      --bg: #0f172a;
      --panel: #111827;
      --muted: #94a3b8;
      --text: #e5e7eb;
      --accent: #22c55e;
      --accent-2: #60a5fa;
      --danger: #ef4444;
      --warning: #f59e0b;
    }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Noto Sans, Helvetica Neue, Arial;
      background: radial-gradient(1200px 1200px at 80% -20%, #1f2937 0, var(--bg) 50%);
      color: var(--text);
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 16px;
      min-height: 100vh;
      overflow-x: hidden;
    }
    .card {
      width: min(700px, 100vw);
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border: 1px solid rgba(255,255,255,.08);
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0,0,0,.45);
      padding: 24px 20px 18px;
      backdrop-filter: blur(6px);
      transform: scale(0.9);
      transform-origin: center top;
    }

    .display {
      user-select: none;
      display: flex; justify-content: center; align-items: center;
      font-size: clamp(96px, 14vw, 144px);
      padding: calc(80px - 0.25cm) 0;
      border-radius: 24px;
      border: 2px solid rgba(255,255,255,.2);
      background: rgba(255,255,255,.04);
      margin: 8px 0 20px;
    }
    .display small { font-size: .33em; color: var(--muted); margin-left: 8px; }
    .actions { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px; }
    button {
      border: 1px solid rgba(255,255,255,.15);
      background: #0b1220; color: var(--text);
      padding: 10px 14px; border-radius: 12px; font-size: 15px;
      cursor: pointer; transition: transform .02s ease;
    }
    .primary { background: linear-gradient(180deg, var(--accent), #16a34a); color: #041e0e; font-weight: 700; }
    .warn { background: linear-gradient(180deg, var(--warning), #d97706); color: #2e1b00; border: none;
            width: 100%; font-size: clamp(48px, 7vw, 72px); padding: calc(80px - 0.25cm) 0;
            border-radius: 24px; box-shadow: 0 12px 40px rgba(245,158,11,.5);
            font-weight: 900; margin-top: 22px; letter-spacing: 1px; }
  </style>
</head>
<body>
  <main class="card">
    <h1>倒數計時器</h1>
    <div id="screen" class="display">00:00<small id="ms">.0</small></div>

    <div>
      <label>起始時間：</label>
      <input id="min" type="number" min="0" value="5">分
      <input id="sec" type="number" min="0" max="59" value="0">秒
      <label>加時：</label>
      <input id="inc" type="number" min="1" value="60">秒
    </div>

    <div class="actions">
      <button id="startPause" class="primary">開始</button>
      <button id="reset">重設</button>
      <button id="quick1m">+1 分鐘</button>
      <button id="quick30s">+30 秒</button>
    </div>

    <button id="add" class="warn">+ 加時</button>
  </main>

  <script>
    const screen=document.getElementById('screen'),msSmall=document.getElementById('ms');
    const startBtn=document.getElementById('startPause'),resetBtn=document.getElementById('reset'),
          addBtn=document.getElementById('add'),quick1=document.getElementById('quick1m'),quick30=document.getElementById('quick30s');
    const min=document.getElementById('min'),sec=document.getElementById('sec'),inc=document.getElementById('inc');
    let running=false,remain=0,target=0,raf,tick;

    function fmt(ms){ms=Math.max(0,ms|0);const t=Math.floor(ms/1e3),m=Math.floor(t/60),s=t%60,d=Math.floor(ms%1e3/100);return{m,s,d}}
    function render(ms){const{m,s,d}=fmt(ms);if(screen.firstChild)screen.removeChild(screen.firstChild);
      const t=document.createTextNode(`${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`);screen.insertBefore(t,msSmall);
      msSmall.textContent=`.${d}`;document.title=`${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')} ⏳`}
    function read(){return((+min.value||0)*60+(+sec.value||0))*1e3;}
    function start(){if(running)return;if(remain<=0)remain=read();if(remain<=0)return alert('請設定時間');
      running=true;target=performance.now()+remain;startBtn.textContent='暫停';tickFn();loop();}
    function pause(){if(!running)return;running=false;remain=Math.max(0,target-performance.now());
      startBtn.textContent='開始';cancel();}
    function reset(){running=false;remain=read();startBtn.textContent='開始';render(remain);cancel();}
    function add(s){if(s<=0)return;if(!running){remain+=s*1e3;render(remain);return;}target+=s*1e3;}
    function tickFn(){tick&&clearTimeout(tick);const f=()=>{const l=Math.max(0,target-performance.now());
      render(l);if(l<=0)return done();tick=setTimeout(f,100)};tick=setTimeout(f,0);}
    function loop(){const s=()=>{if(!running)return;const l=Math.max(0,target-performance.now());
      if(l<=0)return done();raf=requestAnimationFrame(s)};raf=requestAnimationFrame(s)}
    function cancel(){raf&&cancelAnimationFrame(raf);tick&&clearTimeout(tick);}
    function beep(){try{const c=new(AudioContext||webkitAudioContext)(),o=c.createOscillator(),g=c.createGain();
      o.type='sine';o.frequency.value=880;g.gain.setValueAtTime(.001,c.currentTime);
      g.gain.exponentialRampToValueAtTime(.3,c.currentTime+.01);
      g.gain.exponentialRampToValueAtTime(.0001,c.currentTime+.35);
      o.connect(g).connect(c.destination);o.start();o.stop(c.currentTime+.4);}catch{}}
    function done(){running=false;startBtn.textContent='開始';render(0);beep();
      // 🔔 長震警示
      if (navigator.vibrate) navigator.vibrate(600);
      cancel();}
    startBtn.onclick=()=>running?pause():start();resetBtn.onclick=reset;
    addBtn.onclick=()=>add(+inc.value||0);quick1.onclick=()=>add(60);quick30.onclick=()=>add(30);
    remain=read();render(remain);
    if('serviceWorker'in navigator){window.addEventListener('load',()=>navigator.serviceWorker.register('./sw.js',{scope:'./'}));}
  </script>
</body>
</html>